<div class="clientes-container">
  <div class="page-header">
    <div>
      <h1>Gestión de Clientes</h1>
      <p class="subtitle">Administra los clientes de tu cartera de créditos</p>
    </div>
    <button
      mat-raised-button
      color="primary"
      (click)="abrirFormulario()"
      [disabled]="loading"
    >
      <mat-icon>person_add</mat-icon>
      Nuevo Cliente
    </button>
  </div>

  <!-- Search Section -->
  <mat-card class="search-card">
    <mat-card-content>
      <form [formGroup]="searchForm" (ngSubmit)="buscar()">
        <div class="search-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Buscar cliente</mat-label>
            <input
              matInput
              formControlName="busqueda"
              placeholder="Nombres, apellidos, DNI o teléfono..."
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <button
            mat-raised-button
            type="submit"
            color="primary"
            [disabled]="loading"
          >
            Buscar
          </button>

          <button mat-stroked-button type="button" (click)="limpiarBusqueda()">
            Limpiar
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando clientes...</p>
  </div>

  <!-- Table Section -->
  <mat-card *ngIf="!loading" class="table-card">
    <div class="table-wrapper">
      <table mat-table [dataSource]="dataSource" class="clientes-table">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let element">{{ element.id }}</td>
        </ng-container>

        <!-- Nombre Completo Column -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Nombre</th>
          <td mat-cell *matCellDef="let element">
            {{ getNombreCompleto(element) }}
          </td>
        </ng-container>

        <!-- DNI Column -->
        <ng-container matColumnDef="dni">
          <th mat-header-cell *matHeaderCellDef>DNI</th>
          <td mat-cell *matCellDef="let element">
            {{ element.dni || '-' }}
          </td>
        </ng-container>

        <!-- Telefono Column -->
        <ng-container matColumnDef="telefono">
          <th mat-header-cell *matHeaderCellDef>Teléfono</th>
          <td mat-cell *matCellDef="let element">
            {{ element.telefono || '-' }}
          </td>
        </ng-container>

        <!-- Activo Column -->
        <ng-container matColumnDef="activo">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let element">
            <span
              class="status-badge"
              [class.active]="element.activo !== false"
              [class.inactive]="element.activo === false"
            >
              {{ element.activo === false ? 'Inactivo' : 'Activo' }}
            </span>
          </td>
        </ng-container>

        <!-- Acciones Column -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let element">
            <button
              mat-icon-button
              matTooltip="Editar"
              (click)="abrirFormulario(element)"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <button
              mat-icon-button
              matTooltip="Eliminar"
              color="warn"
              (click)="eliminarCliente(element.id, getNombreCompleto(element))"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

        <!-- No data message -->
        <tr class="no-data-row" *ngIf="dataSource.data.length === 0">
          <td [attr.colspan]="displayedColumns.length">
            <div class="no-data-message">
              <mat-icon>people</mat-icon>
              <p>No hay clientes registrados</p>
            </div>
          </td>
        </tr>
      </table>
    </div>

    <!-- Paginator -->
    <mat-paginator
      [length]="totalRegistros"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
    ></mat-paginator>
  </mat-card>
</div>
